var MYBB_SMILIES={},i;for(i in smileyMapurl)MYBB_SMILIES[smileyMapurl[i]]=smileyMapdes[i];function isOrContains(a,f){for(;a;){if(a===f)return!0;a=a.parentNode}return!1}function elementContainsSelection(a){var f;if($.trim(window.getSelection().toString())&&(f=window.getSelection(),0<f.rangeCount)){for(var e=0;e<f.rangeCount;++e)if(!isOrContains(f.getRangeAt(e).commonAncestorContainer,a))return!1;return!0}return!1}
function quick_quote(a,f,e){function b(){setTimeout(function(){elementContainsSelection(document.getElementById("pid_"+a+""))?$("#qr_pid_"+a+"").show():$("#qr_pid_"+a+"").hide()},50)}$(".new_reply_button").length&&$("#quick_reply_form").length&&($("#pid_"+a+"").mousemove(b).click(b).find("blockquote"),$('body:not("#pid_'+a+'")').click(function(){$.trim(window.getSelection().toString())||$("#qr_pid_"+a+"").hide()}),$("#qr_pid_"+a+"").click(function(b){b.preventDefault();setTimeout(function(){elementContainsSelection(document.getElementById("pid_"+
a+""))?Thread.quickQuote(a,""+f+"",e):$("#qr_pid_"+a+"").hide()},200)}))}Thread.quickQuote=function(a,f,e){window.getSelection().toString().trim()&&(userSelection=window.getSelection().getRangeAt(0).cloneContents(),a=parseInt(rinvbquote)?"[quote\x3d"+f+";"+a+"]\n":"[quote\x3d'"+f+"' pid\x3d'"+a+"' dateline\x3d'"+e+"']\n",a+=Thread.domToBB(userSelection,MYBB_SMILIES),a+="\n[/quote]\n",delete userSelection,Thread.updateMessageBox(a))};
Thread.updateMessageBox=function(a){MyBBEditor.insertText(a,"","","","quote");setTimeout(function(){offset=$("#quickreply_e").offset().top-60;setTimeout(function(){$("html, body").animate({scrollTop:offset},700)},200)},100)};Thread.RGBtoHex=function(a,f,e){return Thread.toHex(a)+Thread.toHex(f)+Thread.toHex(e)};
Thread.toHex=function(a){if(null==a)return"00";a=parseInt(a);if(0==a||isNaN(a))return"00";a=Math.max(0,a);a=Math.min(a,255);a=Math.round(a);return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};
Thread.domToBB=function(a,f){for(var e="",b,c,g,d,h=0;h<a.childNodes.length;h++)if(b=a.childNodes[h],d=g=c="","undefined"==typeof b.tagName)switch(b.nodeName){case "#text":e+=b.data.replace(/[\n\t]+/,"")}else{switch(b.tagName){case "SPAN":switch(!0){case "underline"==b.style.textDecoration:c="[u]";d="[/u]";break;case 0<b.style.fontWeight:case "bold"==b.style.fontWeight:c="[b]";d="[/b]";break;case "italic"==b.style.fontStyle:c="[i]";d="[/i]";break;case ""!=b.style.fontFamily:c="[font\x3d"+b.style.fontFamily+
"]";d="[/font]";break;case ""!=b.style.fontSize:c="[size\x3d"+b.style.fontSize+"]";d="[/size]";break;case ""!=b.style.color:-1!=b.style.color.indexOf("rgb")?(c=b.style.color.replace("rgb(","").replace(")","").split(","),c="#"+Thread.RGBtoHex(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))):c=b.style.color,c="[color\x3d"+c+"]",d="[/color]"}break;case "STRONG":case "B":c="[b]";d="[/b]";break;case "EM":case "I":c="[i]";d="[/i]";break;case "U":c="[u]";d="[/u]";break;case "IMG":f[b.src]?(c="",g=f[b.src],
d=""):(c="[img]",g=b.src,d="[/img]");break;case "A":switch(!0){case 0==b.href.indexOf("mailto:"):c="[email\x3d"+b.href.replace("mailto:","")+"]";d="[/email]";break;default:c="[url\x3d"+b.href+"]",d="[/url]"}break;case "OL":c="[list\x3d"+b.type+"]";d="\n[/list]";break;case "UL":c="[list]";d="\n[/list]";break;case "LI":c="\n[*]";d="";break;case "BLOCKQUOTE":b.removeChild(b.firstChild);c="[quote]\n";d="\n[/quote]";break;case "DIV":b.style.textAlign&&(c="[align\x3d"+b.style.textAlign+"]\n",d="\n[/align]\n");
switch(b.className){case "codeblock":c="[code]\n";d="\n[/code]";b.removeChild(b.getElementsByTagName("div")[0]);break;case "codeblock phpcodeblock":g=b.getElementsByTagName("code")[0],b.removeChild(b.getElementsByTagName("div")[0]),c="[php]\n",g=g.innerText?g.innerText:g.innerHTML.replace(/<br([^>]*)>/gi,"\n").replace(/<([^<]+)>/gi,"").replace(/&nbsp;/gi," "),d="\n[/php]"}break;case "P":d="\n\n";break;case "BR":d="\n"}e+=c+g;""==g&&b.childNodes&&0<b.childNodes.length&&(e+=Thread.domToBB(b,f));e+=
d}return e};